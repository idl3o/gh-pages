<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Smart Contract Security Best Practices Action List | Project Documentation Hub</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Smart Contract Security Best Practices Action List" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Central documentation for TypeScript SDK, Smart Contracts, RED X Backend, and Serverless Functions" />
<meta property="og:description" content="Central documentation for TypeScript SDK, Smart Contracts, RED X Backend, and Serverless Functions" />
<link rel="canonical" href="/docs/SECURITY_BEST_PRACTICES.html" />
<meta property="og:url" content="/docs/SECURITY_BEST_PRACTICES.html" />
<meta property="og:site_name" content="Project Documentation Hub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Smart Contract Security Best Practices Action List" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Central documentation for TypeScript SDK, Smart Contracts, RED X Backend, and Serverless Functions","headline":"Smart Contract Security Best Practices Action List","url":"/docs/SECURITY_BEST_PRACTICES.html"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/css/main.css">
  
</head>
<body>
  


  <div class="container-lg px-3 my-5 markdown-body">
    
    <!-- prettier-ignore-start -->
    <h1><a href="/">Project Documentation Hub</a></h1>
    <!-- prettier-ignore-end -->
    

    <article class="post">

  <header class="post-header">
    <h1 class="post-title">Smart Contract Security Best Practices Action List</h1>
  </header>

  <div class="post-content">
    <h1 id="smart-contract-security-best-practices-action-list">Smart Contract Security Best Practices Action List</h1>

<h2 id="access-control">Access Control</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement proper role-based access control (RBAC) using OpenZeppelinâ€™s AccessControl</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good example
</span><span class="k">import</span> <span class="s">"@openzeppelin/contracts/access/AccessControl.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">SecureContract</span> <span class="k">is</span> <span class="n">AccessControl</span> <span class="p">{</span>
    <span class="kt">bytes32</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">ADMIN_ROLE</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">"ADMIN_ROLE"</span><span class="p">);</span>
    <span class="kt">bytes32</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">OPERATOR_ROLE</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">"OPERATOR_ROLE"</span><span class="p">);</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">DEFAULT_ADMIN_ROLE</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">adminFunction</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Admin-only functionality
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Avoid using <code class="language-plaintext highlighter-rouge">tx.origin</code> for authorization (use <code class="language-plaintext highlighter-rouge">msg.sender</code> instead)</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bad - vulnerable to phishing attacks
</span><span class="k">function</span> <span class="n">unsafeWithdraw</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span> <span class="s">"Not owner"</span><span class="p">);</span>
    <span class="c1">// ...
</span><span class="p">}</span>

<span class="c1">// Good - uses direct caller
</span><span class="k">function</span> <span class="n">safeWithdraw</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span> <span class="s">"Not owner"</span><span class="p">);</span>
    <span class="c1">// ...
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Ensure critical functions have appropriate access restrictions</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use multi-signature for high-value operations</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify function caller identity before executing privileged operations</li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement timelocks for critical parameter changes</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Using a timelock for parameter changes
</span><span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">TIMELOCK_DURATION</span> <span class="o">=</span> <span class="mi">2</span> <span class="kc">days</span><span class="p">;</span>
<span class="kt">uint256</span> <span class="k">public</span> <span class="n">proposedFee</span><span class="p">;</span>
<span class="kt">uint256</span> <span class="k">public</span> <span class="n">proposalTime</span><span class="p">;</span>

<span class="k">function</span> <span class="n">proposeFeeChange</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">newFee</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="n">proposedFee</span> <span class="o">=</span> <span class="n">newFee</span><span class="p">;</span>
    <span class="n">proposalTime</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>
    <span class="k">emit</span> <span class="n">FeeChangeProposed</span><span class="p">(</span><span class="n">newFee</span><span class="p">,</span> <span class="n">proposalTime</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">executeeFeeChange</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">&gt;=</span> <span class="n">proposalTime</span> <span class="o">+</span> <span class="n">TIMELOCK_DURATION</span><span class="p">,</span> <span class="s">"Timelock not expired"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">proposalTime</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"No proposal exists"</span><span class="p">);</span>

    <span class="n">platformFee</span> <span class="o">=</span> <span class="n">proposedFee</span><span class="p">;</span>
    <span class="n">proposalTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">emit</span> <span class="n">FeeChanged</span><span class="p">(</span><span class="n">proposedFee</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use modifiers consistently for access control</li>
</ul>

<h2 id="input-validation">Input Validation</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Validate all function parameters</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Parameter validation
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">to</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"Cannot transfer to zero address"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Amount must be positive"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">),</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>

    <span class="c1">// Function logic
</span>    <span class="c1">// ...
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check for zero-address inputs in critical functions
    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setAdmin</span><span class="p">(</span><span class="kt">address</span> <span class="n">newAdmin</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">newAdmin</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"New admin cannot be zero address"</span><span class="p">);</span>
    <span class="n">admin</span> <span class="o">=</span> <span class="n">newAdmin</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Validate array lengths before processing</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">batchTransfer</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">recipients</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">amounts</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Validate array inputs
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">recipients</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Empty recipients array"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">recipients</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">amounts</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="s">"Array length mismatch"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">recipients</span><span class="p">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"Batch too large"</span><span class="p">);</span> <span class="c1">// Prevent DOS attacks
</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">recipients</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Additional validation for each element
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"Invalid recipient"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">amounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Invalid amount"</span><span class="p">);</span>

        <span class="c1">// Process transfer
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement reasonable upper and lower bounds for numerical inputs</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setFee</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">newFeePercentage</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyAdmin</span> <span class="p">{</span>
    <span class="c1">// Set reasonable boundaries
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">newFeePercentage</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"Fee too low"</span><span class="p">);</span> <span class="c1">// 1% minimum
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">newFeePercentage</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">"Fee too high"</span><span class="p">);</span> <span class="c1">// 10% maximum
</span>
    <span class="n">feePercentage</span> <span class="o">=</span> <span class="n">newFeePercentage</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify external contract addresses before interactions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setExternalContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">contractAddress</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyAdmin</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">contractAddress</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"Invalid contract address"</span><span class="p">);</span>

    <span class="c1">// Verify the contract has the expected interface
</span>    <span class="k">try</span> <span class="n">IExpectedInterface</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="n">requiredFunction</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">externalContract</span> <span class="o">=</span> <span class="n">contractAddress</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nb">revert</span><span class="p">(</span><span class="s">"Address does not implement required interface"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check string inputs for empty values and reasonable length</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Validate that arrays have matching lengths in batch operations</li>
</ul>

<h2 id="arithmetic-safety">Arithmetic Safety</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use SafeMath for Solidity versions &lt; 0.8.0</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// For Solidity &lt; 0.8.0
</span><span class="k">import</span> <span class="s">"@openzeppelin/contracts/math/SafeMath.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">OlderContract</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">safeCalculation</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Safe from overflow/underflow
</span>        <span class="kt">uint256</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="kt">uint256</span> <span class="n">product</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">product</span><span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="n">sum</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Add explicit overflow/underflow checks for Solidity â‰¥ 0.8.0</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// For Solidity &gt;= 0.8.0 (built-in overflow checks)
</span><span class="k">function</span> <span class="n">calculation</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Automatically reverts on overflow
</span>    <span class="kt">uint256</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">product</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>

    <span class="c1">// Still need explicit check for division by zero
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Division by zero"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">product</span> <span class="o">/</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// For unchecked math in 0.8.0+ (when optimization is needed)
</span><span class="k">function</span> <span class="n">optimizedCalculation</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">unchecked</span> <span class="p">{</span>
        <span class="c1">// No automatic overflow checks in this block - use only when safe
</span>        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Avoid division before multiplication (to prevent precision loss)</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bad - precision loss
</span><span class="k">function</span> <span class="n">badCalculation</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">c</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// Precision loss if a &lt; b
</span><span class="p">}</span>

<span class="c1">// Good - multiplication before division
</span><span class="k">function</span> <span class="n">goodCalculation</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">c</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// Better precision maintained
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check for division by zero
    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">safeDivide</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">b</span><span class="p">)</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Division by zero"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use appropriate data types (uint256, uint128, etc.) for the value ranges needed</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good practice - using appropriate sized types
</span><span class="k">contract</span> <span class="n">EfficientStorage</span> <span class="p">{</span>
    <span class="c1">// For flags that only need true/false
</span>    <span class="kt">bool</span> <span class="k">public</span> <span class="n">isActive</span><span class="p">;</span>

    <span class="c1">// For small numbers (&lt; 256)
</span>    <span class="kt">uint8</span> <span class="k">public</span> <span class="n">smallCounter</span><span class="p">;</span>

    <span class="c1">// For percentages (0-100)
</span>    <span class="kt">uint8</span> <span class="k">public</span> <span class="n">percentage</span><span class="p">;</span>

    <span class="c1">// For medium-sized numbers
</span>    <span class="kt">uint64</span> <span class="k">public</span> <span class="n">mediumValue</span><span class="p">;</span>

    <span class="c1">// For large numbers or currency amounts
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">largeAmount</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Set reasonable limits on calculations to prevent gas limits issues</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">processBatch</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">data</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Prevent excessive gas costs
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"Batch too large"</span><span class="p">);</span>

    <span class="kt">uint256</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Prevent overflow
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">total</span><span class="p">,</span> <span class="s">"Overflow detected"</span><span class="p">);</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">// Process the total
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify mathematical invariants with require statements</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">swapTokens</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amountIn</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">minAmountOut</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// ... calculation logic ...
</span>    <span class="kt">uint256</span> <span class="n">amountOut</span> <span class="o">=</span> <span class="n">calculateSwapOutput</span><span class="p">(</span><span class="n">amountIn</span><span class="p">);</span>

    <span class="c1">// Verify mathematical invariant
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">amountOut</span> <span class="o">&gt;=</span> <span class="n">minAmountOut</span><span class="p">,</span> <span class="s">"Slippage too high"</span><span class="p">);</span>

    <span class="c1">// Execute swap
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="reentrancy-protection">Reentrancy Protection</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement checks-effects-interactions pattern</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bad - vulnerable to reentrancy
</span><span class="k">function</span> <span class="n">unsafeWithdraw</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">// Interaction before state change
</span>        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amount</span><span class="p">}(</span><span class="s">""</span><span class="p">);</span>

        <span class="c1">// State change after interaction
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Good - follows checks-effects-interactions pattern
</span><span class="k">function</span> <span class="n">safeWithdraw</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Checks
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">],</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>

    <span class="c1">// Effects (state changes)
</span>    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>

    <span class="c1">// Interactions (external calls)
</span>    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amount</span><span class="p">}(</span><span class="s">""</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use ReentrancyGuard for functions involving external calls</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"@openzeppelin/contracts/security/ReentrancyGuard.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">SecureContract</span> <span class="k">is</span> <span class="n">ReentrancyGuard</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">nonReentrant</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amount</span><span class="p">}(</span><span class="s">""</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Complete all internal state changes before calling external contracts</li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Be aware of cross-function reentrancy vulnerabilities</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Vulnerable to cross-function reentrancy
</span><span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">private</span> <span class="n">balances</span><span class="p">;</span>

<span class="k">function</span> <span class="n">getBalance</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">account</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">nonReentrant</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>
    <span class="c1">// Even with nonReentrant, an attacker contract could call getBalance()
</span>    <span class="c1">// between these operations to get information
</span>    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amount</span><span class="p">}(</span><span class="s">""</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>  <span class="c1">// State change after interaction (wrong order)
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Avoid calls to untrusted contracts</li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use pull-over-push pattern for payments</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Push pattern (less secure)
</span><span class="k">function</span> <span class="n">distributeRewards</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">recipients</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">amounts</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">recipients</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amounts</span><span class="p">[</span><span class="n">i</span><span class="p">]}(</span><span class="s">""</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Pull pattern (more secure)
</span><span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">pendingRewards</span><span class="p">;</span>

<span class="k">function</span> <span class="n">allocateRewards</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">recipients</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">amounts</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">recipients</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pendingRewards</span><span class="p">[</span><span class="n">recipients</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">amounts</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">withdrawRewards</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">pendingRewards</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">];</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"No rewards to withdraw"</span><span class="p">);</span>

    <span class="c1">// Update state before interaction
</span>    <span class="n">pendingRewards</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Execute external call after state change
</span>    <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">call</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">amount</span><span class="p">}(</span><span class="s">""</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Lock state during complex operations</li>
</ul>

<h2 id="gas-optimization">Gas Optimization</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Batch operations when possible to save gas</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient - multiple transactions
</span><span class="k">function</span> <span class="n">approveOne</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">)</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Not owner"</span><span class="p">);</span>
    <span class="n">approve</span><span class="p">(</span><span class="n">spender</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Efficient - batch approval in one transaction
</span><span class="k">function</span> <span class="n">batchApprove</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">tokenIds</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tokenIds</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenIds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Not owner"</span><span class="p">);</span>
        <span class="n">approve</span><span class="p">(</span><span class="n">spender</span><span class="p">,</span> <span class="n">tokenIds</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use calldata instead of memory for function parameters when appropriate</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// More gas - uses memory for arrays
</span><span class="k">function</span> <span class="n">processItems</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">items</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">items</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Process items[i]
</span>    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Less gas - uses calldata for read-only arrays
</span><span class="k">function</span> <span class="n">processItems</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">items</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">items</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Process items[i]
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Store only essential data on-chain</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient - stores full metadata on-chain
</span><span class="k">function</span> <span class="n">createItem</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">description</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">fullMetadata</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="n">items</span><span class="p">[</span><span class="n">itemId</span><span class="p">]</span> <span class="o">=</span> <span class="n">Item</span><span class="p">({</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">:</span> <span class="n">fullMetadata</span> <span class="c1">// Could be very large
</span>    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Efficient - stores metadata hash on-chain, full data off-chain
</span><span class="k">function</span> <span class="n">createItem</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">description</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">metadataHash</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="n">items</span><span class="p">[</span><span class="n">itemId</span><span class="p">]</span> <span class="o">=</span> <span class="n">Item</span><span class="p">({</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="n">metadataHash</span><span class="o">:</span> <span class="n">metadataHash</span> <span class="c1">// Just the hash, full data on IPFS
</span>    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use appropriate data types (uint8, bool, etc.) and pack variables when possible</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient storage packing
</span><span class="k">contract</span> <span class="n">Unpacked</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="k">public</span> <span class="n">isActive</span><span class="p">;</span>     <span class="c1">// Slot 0 (1 byte used)
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">amount</span><span class="p">;</span>    <span class="c1">// Slot 1 (32 bytes)
</span>    <span class="kt">bool</span> <span class="k">public</span> <span class="n">isFinalized</span><span class="p">;</span>  <span class="c1">// Slot 2 (1 byte used)
</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>     <span class="c1">// Slot 3 (20 bytes used)
</span><span class="p">}</span>

<span class="c1">// Efficient storage packing
</span><span class="k">contract</span> <span class="n">Packed</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="k">public</span> <span class="n">isActive</span><span class="p">;</span>     <span class="c1">// Slot 0 (1 byte used)
</span>    <span class="kt">bool</span> <span class="k">public</span> <span class="n">isFinalized</span><span class="p">;</span>  <span class="c1">// Slot 0 (1 byte used)
</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>     <span class="c1">// Slot 0 (20 bytes used)
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">amount</span><span class="p">;</span>    <span class="c1">// Slot 1 (32 bytes)
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Cache storage variables in memory for multiple uses within functions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient - multiple storage reads
</span><span class="k">function</span> <span class="n">processStakes</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">stakers</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="n">reward</span> <span class="o">=</span> <span class="n">stakes</span><span class="p">[</span><span class="n">stakers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">rewardRate</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">stakes</span><span class="p">[</span><span class="n">stakers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">stakes</span><span class="p">[</span><span class="n">stakers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">reward</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Efficient - cache storage variables
</span><span class="k">function</span> <span class="n">processStakes</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">rewardRate</span><span class="p">;</span> <span class="c1">// Cache storage variable
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">stakers</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">staker</span> <span class="o">=</span> <span class="n">stakers</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">uint256</span> <span class="n">stakerBalance</span> <span class="o">=</span> <span class="n">stakes</span><span class="p">[</span><span class="n">staker</span><span class="p">];</span> <span class="c1">// Cache storage variable
</span>        <span class="kt">uint256</span> <span class="n">reward</span> <span class="o">=</span> <span class="n">stakerBalance</span> <span class="o">*</span> <span class="n">rate</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">stakes</span><span class="p">[</span><span class="n">staker</span><span class="p">]</span> <span class="o">=</span> <span class="n">stakerBalance</span> <span class="o">+</span> <span class="n">reward</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Avoid unnecessary contract calls</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient - repeated external calls
</span><span class="k">function</span> <span class="n">getTotalValue</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">token</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">user</span><span class="p">);</span> <span class="c1">// Repeated external call
</span>    <span class="p">}</span>
    <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Efficient - single external call
</span><span class="k">function</span> <span class="n">getTotalValue</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="nb">balance</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">user</span><span class="p">);</span> <span class="c1">// Single external call
</span>    <span class="k">return</span> <span class="nb">balance</span> <span class="o">*</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use efficient loops and exit early when conditions are met</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inefficient loop
</span><span class="k">function</span> <span class="n">findElement</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">storage</span> <span class="n">array</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">found</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">found</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">found</span><span class="p">;</span> <span class="c1">// Processes the entire array even if found early
</span><span class="p">}</span>

<span class="c1">// Efficient loop with early exit
</span><span class="k">function</span> <span class="n">findElement</span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">storage</span> <span class="n">array</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// Exit as soon as found
</span>        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="proxy-patterns-and-upgradability">Proxy Patterns and Upgradability</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Understand the different proxy patterns and their tradeoffs</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. Transparent Proxy Pattern
// Implementation contract
</span><span class="k">contract</span> <span class="n">ImplementationV1</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">setValue</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Proxy contract using OpenZeppelin's TransparentUpgradeableProxy
// import "@openzeppelin/contracts/proxy/transparent/TransparentUpgradeableProxy.sol";
</span>
<span class="c1">// 2. UUPS (Universal Upgradeable Proxy Standard)
// Implementation contract with upgrade logic
</span><span class="k">import</span> <span class="s">"@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">UUPSImplementation</span> <span class="k">is</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">initialize</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">external</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">setValue</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="n">onlyOwner</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// 3. Diamond Pattern (EIP-2535)
// Allows multiple implementation contracts (facets)
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Be aware of storage collision issues in upgradeable contracts</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// V1 Implementation
</span><span class="k">contract</span> <span class="n">StorageV1</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>      <span class="c1">// Slot 0
</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>      <span class="c1">// Slot 1
</span>
    <span class="c1">// Reserve storage for future upgrades
</span>    <span class="kt">uint256</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span> <span class="k">private</span> <span class="n">__gap</span><span class="p">;</span> <span class="c1">// Slots 2-49
</span><span class="p">}</span>

<span class="c1">// V2 Implementation - Safe
</span><span class="k">contract</span> <span class="n">StorageV2</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>      <span class="c1">// Slot 0 (unchanged)
</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>      <span class="c1">// Slot 1 (unchanged)
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">newValue</span><span class="p">;</span>   <span class="c1">// Slot 2
</span>
    <span class="c1">// Reduced gap to maintain total storage layout
</span>    <span class="kt">uint256</span><span class="p">[</span><span class="mi">47</span><span class="p">]</span> <span class="k">private</span> <span class="n">__gap</span><span class="p">;</span> <span class="c1">// Slots 3-49
</span><span class="p">}</span>

<span class="c1">// V2 Implementation - UNSAFE (would cause storage collision)
</span><span class="k">contract</span> <span class="n">StorageV2Unsafe</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>      <span class="c1">// Slot 0 (COLLISION with value in V1!)
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>      <span class="c1">// Slot 1 (COLLISION with owner in V1!)
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">newValue</span><span class="p">;</span>   <span class="c1">// Slot 2
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement secure initialization patterns for upgradeable contracts</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Anti-pattern: using constructor for initialization
</span><span class="k">contract</span> <span class="n">UnsafeUpgradeableContract</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

    <span class="c1">// WRONG: Constructor code won't be executed in the proxy context
</span>    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Safe pattern: using initializer function
</span><span class="k">import</span> <span class="s">"@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">SafeUpgradeableContract</span> <span class="k">is</span> <span class="n">Initializable</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

    <span class="c1">// Correct: Use initializer function
</span>    <span class="k">function</span> <span class="n">initialize</span><span class="p">()</span> <span class="k">public</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement secure upgrade authorization mechanisms</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Basic authorization
</span><span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="n">onlyOwner</span> <span class="p">{}</span>

<span class="c1">// Advanced authorization with timelock
</span><span class="k">contract</span> <span class="n">TimelockUpgradeable</span> <span class="k">is</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">pendingImplementation</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">upgradeTimestamp</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">UPGRADE_TIMELOCK</span> <span class="o">=</span> <span class="mi">2</span> <span class="kc">days</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">proposeUpgrade</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">pendingImplementation</span> <span class="o">=</span> <span class="n">newImplementation</span><span class="p">;</span>
        <span class="n">upgradeTimestamp</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">+</span> <span class="n">UPGRADE_TIMELOCK</span><span class="p">;</span>
        <span class="k">emit</span> <span class="n">UpgradeProposed</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">,</span> <span class="n">upgradeTimestamp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">(),</span> <span class="s">"Not authorized"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">newImplementation</span> <span class="o">==</span> <span class="n">pendingImplementation</span><span class="p">,</span> <span class="s">"Invalid implementation"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">&gt;=</span> <span class="n">upgradeTimestamp</span><span class="p">,</span> <span class="s">"Timelock not expired"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Multi-signature authorization
</span><span class="k">contract</span> <span class="n">MultiSigUpgradeable</span> <span class="k">is</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="kt">address</span><span class="p">[]</span> <span class="k">public</span> <span class="n">admins</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">public</span> <span class="n">isAdmin</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">))</span> <span class="k">public</span> <span class="n">approvals</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">requiredApprovals</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">approveUpgrade</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">isAdmin</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">],</span> <span class="s">"Not admin"</span><span class="p">);</span>
        <span class="kt">bytes32</span> <span class="n">upgradeHash</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">));</span>
        <span class="n">approvals</span><span class="p">[</span><span class="n">upgradeHash</span><span class="p">][</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="n">upgradeHash</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">));</span>
        <span class="kt">uint256</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">admins</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">approvals</span><span class="p">[</span><span class="n">upgradeHash</span><span class="p">][</span><span class="n">admins</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="p">{</span>
                <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="n">requiredApprovals</span><span class="p">,</span> <span class="s">"Insufficient approvals"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Understand and avoid the delegatecall proxy selector clashing</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Potential selector clash issue
</span><span class="k">contract</span> <span class="n">AdminUpgradeable</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">admin</span><span class="p">;</span>

    <span class="c1">// Function selector: 0x8f283970 (simplified)
</span>    <span class="k">function</span> <span class="n">changeAdmin</span><span class="p">(</span><span class="kt">address</span> <span class="n">newAdmin</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">admin</span> <span class="o">=</span> <span class="n">newAdmin</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">TokenUpgradeable</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">balances</span><span class="p">;</span>

    <span class="c1">// DANGER: Might have same selector as changeAdmin!
</span>    <span class="c1">// Hypothetical function with selector clash
</span>    <span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Solution: Use TransparentProxy pattern where admin functions
// are handled separately, or use unstructured storage approach
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement secure fallback and receive functions for proxy contracts</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">SecureProxy</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">implementation</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">admin</span><span class="p">;</span>

    <span class="c1">// Forward all calls to implementation contract
</span>    <span class="k">fallback</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">_impl</span> <span class="o">=</span> <span class="n">implementation</span><span class="p">;</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">_impl</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// Copy calldata to memory
</span>            <span class="n">calldatacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calldatasize</span><span class="p">())</span>

            <span class="c1">// Forward call to implementation
</span>            <span class="kr">let</span> <span class="n">result</span> <span class="o">:=</span> <span class="nb">delegatecall</span><span class="p">(</span><span class="n">gas</span><span class="p">(),</span> <span class="n">_impl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">calldatasize</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1">// Copy the returned data
</span>            <span class="n">returndatacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span>

            <span class="kr">switch</span> <span class="n">result</span>
            <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span> <span class="p">}</span>
            <span class="kr">default</span> <span class="p">{</span> <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">returndatasize</span><span class="p">())</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Allow contract to receive ETH
</span>    <span class="k">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Track implementation versions and emit upgrade events</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">VersionedUpgradeable</span> <span class="k">is</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="k">public</span> <span class="n">version</span><span class="p">;</span>

    <span class="k">event</span> <span class="n">Upgraded</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">implementation</span><span class="p">,</span> <span class="kt">string</span> <span class="n">version</span><span class="p">);</span>

    <span class="k">function</span> <span class="n">setVersion</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">newVersion</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">newVersion</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">upgradeToAndCall</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">newImplementation</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">newVersion</span>
    <span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">_upgradeToAndCallUUPS</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="k">emit</span> <span class="n">Upgraded</span><span class="p">(</span><span class="n">newImplementation</span><span class="p">,</span> <span class="n">newVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test all upgrade paths thoroughly before production deployment</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example upgrade test using Hardhat</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">chai</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">ethers</span><span class="p">,</span> <span class="nx">upgrades</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hardhat</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Contract Upgrades</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">Should upgrade correctly and preserve state</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">owner</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getSigners</span><span class="p">();</span>

    <span class="c1">// Deploy V1</span>
    <span class="kd">const</span> <span class="nx">ImplementationV1</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">'</span><span class="s1">ImplementationV1</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">upgrades</span><span class="p">.</span><span class="nx">deployProxy</span><span class="p">(</span><span class="nx">ImplementationV1</span><span class="p">,</span> <span class="p">[</span><span class="mi">42</span><span class="p">],</span> <span class="p">{</span>
      <span class="na">initializer</span><span class="p">:</span> <span class="dl">'</span><span class="s1">initialize</span><span class="dl">'</span>
    <span class="p">});</span>
    <span class="k">await</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">deployed</span><span class="p">();</span>

    <span class="c1">// Interact with V1</span>
    <span class="k">await</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">value</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="c1">// Upgrade to V2</span>
    <span class="kd">const</span> <span class="nx">ImplementationV2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ethers</span><span class="p">.</span><span class="nx">getContractFactory</span><span class="p">(</span><span class="dl">'</span><span class="s1">ImplementationV2</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">upgradedProxy</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">upgrades</span><span class="p">.</span><span class="nx">upgradeProxy</span><span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="nx">ImplementationV2</span><span class="p">);</span>

    <span class="c1">// Verify state is preserved</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">upgradedProxy</span><span class="p">.</span><span class="nx">value</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="c1">// Use new V2 functionality</span>
    <span class="k">await</span> <span class="nx">upgradedProxy</span><span class="p">.</span><span class="nx">setValueDoubled</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">upgradedProxy</span><span class="p">.</span><span class="nx">value</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">upgradedProxy</span><span class="p">.</span><span class="nx">valueDoubled</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider immutable vs. upgradeable components</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Split functionality between immutable and upgradeable contracts
</span>
<span class="c1">// Immutable core logic
</span><span class="k">contract</span> <span class="n">TokenCore</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">balances</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">_transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Upgradeable policy layer
</span><span class="k">contract</span> <span class="n">TokenPolicy</span> <span class="k">is</span> <span class="n">Initializable</span> <span class="p">{</span>
    <span class="n">TokenCore</span> <span class="k">public</span> <span class="kr">immutable</span> <span class="n">core</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">public</span> <span class="n">frozen</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_core</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">TokenCore</span><span class="p">(</span><span class="n">_core</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">initialize</span><span class="p">()</span> <span class="k">external</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="c1">// initialization logic
</span>    <span class="p">}</span>

    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">frozen</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">],</span> <span class="s">"Account frozen"</span><span class="p">);</span>
        <span class="n">core</span><span class="p">.</span><span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This policy can be upgraded while core remains immutable
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement emergency pause mechanisms for upgradeable contracts</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"@openzeppelin/contracts-upgradeable/security/PausableUpgradeable.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">PausableToken</span> <span class="k">is</span> <span class="n">PausableUpgradeable</span><span class="p">,</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">initialize</span><span class="p">()</span> <span class="k">public</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="n">__Pausable_init</span><span class="p">();</span>
        <span class="n">__UUPSUpgradeable_init</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">whenNotPaused</span> <span class="p">{</span>
        <span class="c1">// Transfer logic
</span>    <span class="p">}</span>

    <span class="k">function</span> <span class="n">pause</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">_pause</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">unpause</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">_unpause</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="n">onlyOwner</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Document all storage layouts and upgrade procedures
```solidity
/**</p>
    <ul>
      <li>@title TokenV1</li>
      <li>@dev Storage layout:</li>
      <li>
        <ul>
          <li>mapping(address =&gt; uint256) public balances;</li>
        </ul>
      </li>
      <li>
        <ul>
          <li>address public owner;</li>
        </ul>
      </li>
      <li>
        <ul>
          <li>uint256 public totalSupply;</li>
        </ul>
      </li>
      <li>
        <ul>
          <li>uint256[47] private __gap;</li>
        </ul>
      </li>
      <li></li>
      <li>@notice Upgrade Procedure:</li>
      <li>
        <ol>
          <li>Deploy new implementation</li>
        </ol>
      </li>
      <li>
        <ol>
          <li>Call upgradeTo(newImplementation)</li>
        </ol>
      </li>
      <li>
        <ol>
          <li>Verify state preservation</li>
        </ol>
      </li>
      <li>/
contract TokenV1 {
 // Implementation
}
```</li>
    </ul>
  </li>
</ul>

<h2 id="cross-chain-security-considerations">Cross-chain Security Considerations</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement secure bridge interaction patterns</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bad practice - no validation of cross-chain messages
</span><span class="k">function</span> <span class="n">receiveFromBridge</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="o">=</span> <span class="n">abi</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="kt">address</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">));</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Good practice - verify bridge messages
</span><span class="k">function</span> <span class="n">receiveFromBridge</span><span class="p">(</span>
    <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">,</span>
    <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">signature</span>
<span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Verify the bridge's signature
</span>    <span class="nb">require</span><span class="p">(</span><span class="n">verifyBridgeSignature</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">signature</span><span class="p">),</span> <span class="s">"Invalid bridge signature"</span><span class="p">);</span>

    <span class="c1">// Process only after verification
</span>    <span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="o">=</span> <span class="n">abi</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="kt">address</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">));</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use reliable oracles for cross-chain data verification</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Using Chainlink for cross-chain data verification
</span><span class="k">import</span> <span class="s">"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">CrossChainAwareDApp</span> <span class="p">{</span>
    <span class="n">AggregatorV3Interface</span> <span class="k">internal</span> <span class="n">dataFeed</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_oracleAddress</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataFeed</span> <span class="o">=</span> <span class="n">AggregatorV3Interface</span><span class="p">(</span><span class="n">_oracleAddress</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">getLatestData</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Get verified data from another chain via oracle
</span>        <span class="p">(,</span> <span class="kt">int</span> <span class="n">price</span><span class="p">,</span> <span class="p">,</span> <span class="kt">uint</span> <span class="n">timeStamp</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">dataFeed</span><span class="p">.</span><span class="n">latestRoundData</span><span class="p">();</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">timeStamp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Round not complete"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">price</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement replay protection for cross-chain transactions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ReplayProtectedBridge</span> <span class="p">{</span>
    <span class="c1">// Map to track processed message IDs
</span>    <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">public</span> <span class="n">processedMessages</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">processMessage</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">messageId</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">proof</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Check that this message hasn't been processed before
</span>        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">processedMessages</span><span class="p">[</span><span class="n">messageId</span><span class="p">],</span> <span class="s">"Message already processed"</span><span class="p">);</span>

        <span class="c1">// Verify the message is valid
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">verifyMessageProof</span><span class="p">(</span><span class="n">messageId</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">proof</span><span class="p">),</span> <span class="s">"Invalid message proof"</span><span class="p">);</span>

        <span class="c1">// Mark message as processed before execution to prevent reentrancy
</span>        <span class="n">processedMessages</span><span class="p">[</span><span class="n">messageId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="c1">// Execute the message logic
</span>        <span class="n">_executeMessage</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">_executeMessage</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="c1">// Message execution logic
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Handle different finality guarantees between chains</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">FinalityAwareBridge</span> <span class="p">{</span>
    <span class="c1">// Different confirmation requirements per chain
</span>    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">requiredConfirmations</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Example: Ethereum mainnet needs more confirmations than L2s
</span>        <span class="n">requiredConfirmations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="c1">// Ethereum Mainnet
</span>        <span class="n">requiredConfirmations</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span> <span class="c1">// Optimism
</span>        <span class="n">requiredConfirmations</span><span class="p">[</span><span class="mi">42161</span><span class="p">]</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span> <span class="c1">// Arbitrum
</span>    <span class="p">}</span>

    <span class="k">function</span> <span class="n">processTransaction</span><span class="p">(</span>
        <span class="kt">uint256</span> <span class="n">sourceChainId</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="n">txHash</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">confirmations</span>
    <span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Ensure sufficient confirmations based on source chain
</span>        <span class="nb">require</span><span class="p">(</span>
            <span class="n">confirmations</span> <span class="o">&gt;=</span> <span class="n">requiredConfirmations</span><span class="p">[</span><span class="n">sourceChainId</span><span class="p">],</span>
            <span class="s">"Insufficient confirmations"</span>
        <span class="p">);</span>

        <span class="c1">// Process the cross-chain transaction
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement safe asset transfer patterns across chains</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Lock-and-mint pattern for cross-chain transfers
</span><span class="k">contract</span> <span class="n">TokenBridge</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">lockedTokens</span><span class="p">;</span>

    <span class="c1">// Lock tokens on the source chain
</span>    <span class="k">function</span> <span class="n">lockTokens</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">targetChain</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Transfer tokens from user to contract (lock)
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="n">transferFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">amount</span><span class="p">),</span> <span class="s">"Transfer failed"</span><span class="p">);</span>

        <span class="c1">// Record the locked tokens
</span>        <span class="n">lockedTokens</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>

        <span class="c1">// Emit event for the target chain to mint tokens
</span>        <span class="k">emit</span> <span class="n">TokensLocked</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">targetChain</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Release tokens on the source chain if the bridging fails
</span>    <span class="k">function</span> <span class="n">unlockTokens</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">proof</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Verify the unlocking is authorized (e.g., timeout or failure proof)
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">verifyUnlockProof</span><span class="p">(</span><span class="n">proof</span><span class="p">),</span> <span class="s">"Invalid unlock proof"</span><span class="p">);</span>

        <span class="nb">require</span><span class="p">(</span><span class="n">lockedTokens</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient locked tokens"</span><span class="p">);</span>
        <span class="n">lockedTokens</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>

        <span class="c1">// Transfer tokens back to user
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">amount</span><span class="p">),</span> <span class="s">"Transfer failed"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Account for different gas costs and models across chains</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">GasAwareCrossChainExecutor</span> <span class="p">{</span>
    <span class="c1">// Gas limits for different destination chains
</span>    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">gasLimits</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Set different gas limits based on destination chain characteristics
</span>        <span class="n">gasLimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300000</span><span class="p">;</span> <span class="c1">// Ethereum Mainnet
</span>        <span class="n">gasLimits</span><span class="p">[</span><span class="mi">137</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500000</span><span class="p">;</span> <span class="c1">// Polygon
</span>        <span class="n">gasLimits</span><span class="p">[</span><span class="mi">43114</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200000</span><span class="p">;</span> <span class="c1">// Avalanche
</span>    <span class="p">}</span>

    <span class="k">function</span> <span class="n">executeOnDestinationChain</span><span class="p">(</span>
        <span class="kt">uint256</span> <span class="n">targetChainId</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">targetContract</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">callData</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Ensure enough gas is provided for the target chain
</span>        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">gasleft</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">gasLimits</span><span class="p">[</span><span class="n">targetChainId</span><span class="p">],</span>
            <span class="s">"Insufficient gas for cross-chain execution"</span>
        <span class="p">);</span>

        <span class="c1">// Execute cross-chain transaction
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use timeouts and dispute resolution mechanisms for cross-chain operations</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">TimeoutEnabledBridge</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">CrossChainTransfer</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">sender</span><span class="p">;</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">;</span>
        <span class="kt">uint256</span> <span class="n">amount</span><span class="p">;</span>
        <span class="kt">uint256</span> <span class="n">deadline</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">executed</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">refunded</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="n">CrossChainTransfer</span><span class="p">)</span> <span class="k">public</span> <span class="n">transfers</span><span class="p">;</span>

    <span class="c1">// Initiate a cross-chain transfer with timeout
</span>    <span class="k">function</span> <span class="n">initiateTransfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="n">transferId</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="p">));</span>

        <span class="n">transfers</span><span class="p">[</span><span class="n">transferId</span><span class="p">]</span> <span class="o">=</span> <span class="n">CrossChainTransfer</span><span class="p">({</span>
            <span class="n">sender</span><span class="o">:</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
            <span class="n">recipient</span><span class="o">:</span> <span class="n">recipient</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="n">deadline</span><span class="o">:</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">+</span> <span class="mi">24</span> <span class="kc">hours</span><span class="p">,</span> <span class="c1">// 24-hour timeout
</span>            <span class="n">executed</span><span class="o">:</span> <span class="nb">false</span><span class="p">,</span>
            <span class="n">refunded</span><span class="o">:</span> <span class="nb">false</span>
        <span class="p">});</span>

        <span class="c1">// Lock tokens from sender
</span>        <span class="n">token</span><span class="p">.</span><span class="n">transferFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">amount</span><span class="p">);</span>

        <span class="k">emit</span> <span class="n">TransferInitiated</span><span class="p">(</span><span class="n">transferId</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Claim refund after timeout
</span>    <span class="k">function</span> <span class="n">claimRefund</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">transferId</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">CrossChainTransfer</span> <span class="k">storage</span> <span class="nb">transfer</span> <span class="o">=</span> <span class="n">transfers</span><span class="p">[</span><span class="n">transferId</span><span class="p">];</span>

        <span class="nb">require</span><span class="p">(</span><span class="nb">transfer</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="s">"Not transfer initiator"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">&gt;</span> <span class="nb">transfer</span><span class="p">.</span><span class="n">deadline</span><span class="p">,</span> <span class="s">"Timeout not reached"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nb">transfer</span><span class="p">.</span><span class="n">executed</span><span class="p">,</span> <span class="s">"Transfer already executed"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nb">transfer</span><span class="p">.</span><span class="n">refunded</span><span class="p">,</span> <span class="s">"Already refunded"</span><span class="p">);</span>

        <span class="nb">transfer</span><span class="p">.</span><span class="n">refunded</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">token</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="nb">transfer</span><span class="p">.</span><span class="n">amount</span><span class="p">);</span>

        <span class="k">emit</span> <span class="n">TransferRefunded</span><span class="p">(</span><span class="n">transferId</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Handle re-org risks for cross-chain state synchronization</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ReorgAwareBridge</span> <span class="p">{</span>
    <span class="c1">// Minimum confirmations required before processing cross-chain messages
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">requiredConfirmations</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

    <span class="c1">// Mapping of processed events by block number and transaction hash
</span>    <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">))</span> <span class="k">public</span> <span class="n">processedEvents</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">processMessageFromOtherChain</span><span class="p">(</span>
        <span class="kt">uint256</span> <span class="n">blockNumber</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="n">txHash</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">confirmations</span>
    <span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Check sufficient confirmations to mitigate reorg risk
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">confirmations</span> <span class="o">&gt;=</span> <span class="n">requiredConfirmations</span><span class="p">,</span> <span class="s">"Not enough confirmations"</span><span class="p">);</span>

        <span class="c1">// Check if this event was already processed
</span>        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">processedEvents</span><span class="p">[</span><span class="n">blockNumber</span><span class="p">][</span><span class="n">txHash</span><span class="p">],</span> <span class="s">"Already processed"</span><span class="p">);</span>

        <span class="c1">// Mark as processed
</span>        <span class="n">processedEvents</span><span class="p">[</span><span class="n">blockNumber</span><span class="p">][</span><span class="n">txHash</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="c1">// Process the message
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>

    <span class="c1">// Allows updating required confirmations based on network conditions
</span>    <span class="k">function</span> <span class="n">updateRequiredConfirmations</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">newValue</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyGovernance</span> <span class="p">{</span>
        <span class="n">requiredConfirmations</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement chain ID validation to prevent cross-chain replay attacks</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ChainIdAwareContract</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="kr">immutable</span> <span class="n">chainId</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">id</span> <span class="o">:=</span> <span class="n">chainid</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">chainId</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">processSignedMessage</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">message</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">signature</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Recover the signer of the message
</span>        <span class="kt">address</span> <span class="n">signer</span> <span class="o">=</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">);</span>

        <span class="c1">// Verify the message includes the correct chain ID
</span>        <span class="kt">bytes32</span> <span class="n">expectedMessage</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">chainId</span><span class="p">));</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="n">verifyMessage</span><span class="p">(</span><span class="n">expectedMessage</span><span class="p">,</span> <span class="n">signature</span><span class="p">),</span>
            <span class="s">"Signature not valid for this chain"</span>
        <span class="p">);</span>

        <span class="c1">// Process the message
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Track and monitor cross-chain liquidity risks</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">LiquidityMonitoredBridge</span> <span class="p">{</span>
    <span class="c1">// Maximum amount of tokens that can be bridged at once
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">maxTransferAmount</span><span class="p">;</span>

    <span class="c1">// Current liquidity pool on this chain
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">liquidity</span><span class="p">;</span>

    <span class="c1">// Bridge utilization tracking
</span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">bridgeOutflowToday</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">bridgeInflowToday</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">lastResetTimestamp</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">bridgeTokens</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">targetChain</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Check if the amount is within transfer limits
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">maxTransferAmount</span><span class="p">,</span> <span class="s">"Transfer amount too large"</span><span class="p">);</span>

        <span class="c1">// Check if there's sufficient liquidity on the target chain
</span>        <span class="nb">require</span><span class="p">(</span>
            <span class="n">checkTargetChainLiquidity</span><span class="p">(</span><span class="n">targetChain</span><span class="p">,</span> <span class="n">amount</span><span class="p">),</span>
            <span class="s">"Insufficient liquidity on target chain"</span>
        <span class="p">);</span>

        <span class="c1">// Reset daily counters if day has changed
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">lastResetTimestamp</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kc">days</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bridgeOutflowToday</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">bridgeInflowToday</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">lastResetTimestamp</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Update outflow tracker
</span>        <span class="n">bridgeOutflowToday</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>

        <span class="c1">// Additional checks for daily limits, etc.
</span>        <span class="c1">// ...
</span>
        <span class="c1">// Execute the bridge operation
</span>        <span class="c1">// ...
</span>    <span class="p">}</span>

    <span class="c1">// Emergency circuit breaker
</span>    <span class="k">function</span> <span class="n">pauseBridge</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyGuardian</span> <span class="p">{</span>
        <span class="n">_pause</span><span class="p">();</span>
        <span class="k">emit</span> <span class="n">BridgePaused</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="formal-verification">Formal Verification</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider using formal verification tools to mathematically prove contract correctness</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example property specification for formal verification
// Using tools like Certora, Mythril, or SMTChecker
</span>
<span class="c1">/// @custom:invariant totalSupply == sum(balances)
/// @custom:invariant forall (address a) balances[a] &lt;= totalSupply
</span><span class="k">contract</span> <span class="n">VerifiedToken</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">public</span> <span class="n">balances</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">totalSupply</span><span class="p">;</span>

    <span class="c1">// Functions can have pre and post conditions
</span>    <span class="c1">/// @custom:precondition amount &lt;= balances[msg.sender]
</span>    <span class="c1">/// @custom:postcondition balances[msg.sender] == old(balances[msg.sender]) - amount
</span>    <span class="c1">/// @custom:postcondition balances[to] == old(balances[to]) + amount
</span>    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Define and verify critical invariants for your contracts</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Key invariants to prove:
// 1. Conservation of tokens (sum of balances equals totalSupply)
// 2. User balances are always non-negative
// 3. Only authorized users can perform privileged operations
// 4. State transitions follow expected patterns
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use the Solidity SMTChecker for basic verification</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Enable SMTChecker in your Solidity code
/// @custom:smtchecker contracts-show-proved
</span><span class="k">contract</span> <span class="n">SMTCheckedContract</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">x</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">setX</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_x</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">_x</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"Value too large"</span><span class="p">);</span>
        <span class="kt">uint256</span> <span class="n">oldX</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">_x</span><span class="p">;</span>

        <span class="c1">// SMTChecker will verify this assertion
</span>        <span class="nb">assert</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">);</span>
        <span class="nb">assert</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">_x</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Specify and verify pre-conditions and post-conditions for functions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// @custom:precondition balances[msg.sender] &gt;= amount &amp;&amp; amount &gt; 0
/// @custom:postcondition balances[msg.sender] == old(balances[msg.sender]) - amount
/// @custom:postcondition balances[recipient] == old(balances[recipient]) + amount
</span><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Function implementation
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify temporal properties in multi-function and multi-contract scenarios</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Properties that involve multiple steps:
// 1. "If a user deposits funds, they can always withdraw the same amount"
// 2. "A locked asset cannot be transferred until the timelock expires"
// 3. "After a security breach, the contract can be paused and no more funds can leave"
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Ensure high-risk or high-value contracts undergo formal verification</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Priority contracts for formal verification:
// 1. Token contracts handling user funds
// 2. Staking and yield-generating contracts
// 3. Governance mechanisms
// 4. Cross-chain bridges
// 5. DeFi protocols with complex interactions
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Document formal verification results and limitations</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Formal Verification Report

### Verified Properties
- Conservation of tokens: PROVEN
- Access control correctness: PROVEN
- No overflow in calculations: PROVEN

### Limitations
- External contract interactions not verified
- Only verified up to depth 10 transaction traces
- Some complex loops abstracted
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Combine formal verification with traditional testing for comprehensive coverage</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example integration of formal verification in the development workflow</span>

<span class="c1">// 1. Write contracts with verification annotations</span>
<span class="c1">// 2. Run SMT verification during development</span>
<span class="c1">// Solc --model-checker-engine all --model-checker-targets all contract.sol</span>

<span class="c1">// 3. Write traditional tests for scenarios beyond formal verification scope</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Token transfers</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">Should handle transfers that formal verification couldn't fully cover</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Test complex interaction scenarios</span>
    <span class="c1">// Test edge cases identified during formal verification</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// 4. For high-value contracts, use specialized tools and experts</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use formal verification to check for reentrancy and other complex vulnerabilities</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Properties for reentrancy protection verification
// 1. "For any function, state updates must precede external calls"
// 2. "If a function is called reentrantly, it must revert"
// 3. "The balance invariant holds even under reentrancy attacks"
</span></code></pre></div>    </div>
  </li>
</ul>

<h2 id="audit-and-review">Audit and Review</h2>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Engage in formal verification for critical contracts</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Utilize automated tools for vulnerability scanning</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Conduct manual code reviews with a focus on security</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Keep up-to-date with the latest security advisories and patch accordingly</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider bug bounty programs to leverage community expertise</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Review and test all upgrade paths thoroughly before deployment</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Ensure proper testing of all security mechanisms in place</li>
</ul>

<h2 id="emergency-procedures">Emergency Procedures</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement emergency pause functionality</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"@openzeppelin/contracts/security/Pausable.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">SecureExchange</span> <span class="k">is</span> <span class="n">Pausable</span> <span class="p">{</span>
    <span class="c1">// Only admin can pause
</span>    <span class="k">function</span> <span class="n">pauseTrading</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_pause</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Only admin can unpause
</span>    <span class="k">function</span> <span class="n">unpauseTrading</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_unpause</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Functions check paused status
</span>    <span class="k">function</span> <span class="n">executeTrade</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">whenNotPaused</span> <span class="p">{</span>
        <span class="c1">// Trading logic
</span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Add circuit breakers for extreme market conditions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">MarketWithCircuitBreakers</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">lastPrice</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">MAX_PRICE_CHANGE_PERCENT</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// 10%
</span>    <span class="kt">bool</span> <span class="k">public</span> <span class="n">circuitBroken</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">executeOrder</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">newPrice</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Check if price change exceeds threshold
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">lastPrice</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint256</span> <span class="n">priceChange</span> <span class="o">=</span> <span class="n">calculatePercentChange</span><span class="p">(</span><span class="n">lastPrice</span><span class="p">,</span> <span class="n">newPrice</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">priceChange</span> <span class="o">&gt;</span> <span class="n">MAX_PRICE_CHANGE_PERCENT</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">circuitBroken</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="k">emit</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">lastPrice</span><span class="p">,</span> <span class="n">newPrice</span><span class="p">,</span> <span class="n">priceChange</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Normal execution if circuit not broken
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">circuitBroken</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Execute order logic
</span>            <span class="n">lastPrice</span> <span class="o">=</span> <span class="n">newPrice</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">resetCircuitBreaker</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyAdmin</span> <span class="p">{</span>
        <span class="n">circuitBroken</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Create a clear emergency contact process</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">EmergencyContact</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">securityTeam</span><span class="p">;</span>
    <span class="kt">string</span> <span class="k">public</span> <span class="n">emergencyEmail</span><span class="p">;</span>

    <span class="k">event</span> <span class="n">EmergencyContact</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">reporter</span><span class="p">,</span> <span class="kt">string</span> <span class="n">details</span><span class="p">);</span>

    <span class="k">function</span> <span class="n">reportEmergency</span><span class="p">(</span><span class="kt">string</span> <span class="k">calldata</span> <span class="n">details</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="k">emit</span> <span class="n">EmergencyContact</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">details</span><span class="p">);</span>
        <span class="c1">// Can also trigger notifications off-chain through indexing this event
</span>    <span class="p">}</span>

    <span class="k">function</span> <span class="n">updateEmergencyEmail</span><span class="p">(</span><span class="kt">string</span> <span class="k">calldata</span> <span class="n">newEmail</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyAdmin</span> <span class="p">{</span>
        <span class="n">emergencyEmail</span> <span class="o">=</span> <span class="n">newEmail</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Prepare and document emergency response procedures</p>

    <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Emergency Response Procedure</span>
<span class="p">
1.</span> <span class="gs">**Identification**</span>: Monitor events and alerts for potential security incidents
<span class="p">2.</span> <span class="gs">**Assessment**</span>: Security team evaluates impact and severity
<span class="p">3.</span> <span class="gs">**Containment**</span>: If confirmed, activate emergency pause or circuit breakers
<span class="p">4.</span> <span class="gs">**Communication**</span>: Notify users through official channels
<span class="p">5.</span> <span class="gs">**Resolution**</span>: Deploy fix according to upgrade procedure
<span class="p">6.</span> <span class="gs">**Recovery**</span>: Resume operations with enhanced monitoring
<span class="p">7.</span> <span class="gs">**Post-mortem**</span>: Analyze incident, document learnings, improve procedures

<span class="gu">## Severity Levels</span>
<span class="p">
-</span> <span class="gs">**Critical**</span>: Immediate response required (funds at risk)
<span class="p">-</span> <span class="gs">**High**</span>: Response required within 24 hours
<span class="p">-</span> <span class="gs">**Medium**</span>: Response required within 48 hours
<span class="p">-</span> <span class="gs">**Low**</span>: Non-urgent, address in next update
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Design and implement fund recovery mechanisms</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">RecoverableFunds</span> <span class="p">{</span>
    <span class="c1">// Emergency withdrawal function
</span>    <span class="k">function</span> <span class="n">emergencyWithdraw</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">EMERGENCY_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="nb">balance</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="k">payable</span><span class="p">(</span><span class="n">safeAddress</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="nb">balance</span><span class="p">);</span>
        <span class="k">emit</span> <span class="n">EmergencyWithdrawal</span><span class="p">(</span><span class="n">safeAddress</span><span class="p">,</span> <span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Function to recover ERC20 tokens accidentally sent to contract
</span>    <span class="k">function</span> <span class="n">recoverERC20</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenAddress</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">EMERGENCY_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">tokenAddress</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">nativeToken</span><span class="p">),</span> <span class="s">"Cannot withdraw native token"</span><span class="p">);</span>
        <span class="n">IERC20</span><span class="p">(</span><span class="n">tokenAddress</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">safeAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
        <span class="k">emit</span> <span class="n">TokenRecovery</span><span class="p">(</span><span class="n">tokenAddress</span><span class="p">,</span> <span class="n">safeAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Create time-delayed emergency actions</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">TimeDelayedRecovery</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">EMERGENCY_DELAY</span> <span class="o">=</span> <span class="mi">24</span> <span class="kc">hours</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">pendingRecoveryAddress</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">public</span> <span class="n">recoveryProposalTime</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">proposeRecovery</span><span class="p">(</span><span class="kt">address</span> <span class="n">newRecoveryAddress</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pendingRecoveryAddress</span> <span class="o">=</span> <span class="n">newRecoveryAddress</span><span class="p">;</span>
        <span class="n">recoveryProposalTime</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>
        <span class="k">emit</span> <span class="n">RecoveryProposed</span><span class="p">(</span><span class="n">newRecoveryAddress</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">executeRecovery</span><span class="p">()</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">&gt;=</span> <span class="n">recoveryProposalTime</span> <span class="o">+</span> <span class="n">EMERGENCY_DELAY</span><span class="p">,</span> <span class="s">"Delay not satisfied"</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">pendingRecoveryAddress</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"No recovery pending"</span><span class="p">);</span>

        <span class="c1">// Transfer funds to recovery address
</span>        <span class="kt">uint256</span> <span class="nb">balance</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="k">payable</span><span class="p">(</span><span class="n">pendingRecoveryAddress</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="nb">balance</span><span class="p">);</span>

        <span class="c1">// Reset proposal
</span>        <span class="n">pendingRecoveryAddress</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">recoveryProposalTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">emit</span> <span class="n">RecoveryExecuted</span><span class="p">(</span><span class="n">pendingRecoveryAddress</span><span class="p">,</span> <span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="token-standard-compliance">Token Standard Compliance</h2>

<ul class="task-list">
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Fully implement required ERC functions for your chosen token standard</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of proper ERC-20 implementation
</span><span class="k">contract</span> <span class="n">CompliantERC20</span> <span class="k">is</span> <span class="n">IERC20</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">private</span> <span class="n">_balances</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">))</span> <span class="k">private</span> <span class="n">_allowances</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">private</span> <span class="n">_totalSupply</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_totalSupply</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_balances</span><span class="p">[</span><span class="n">account</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">allowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">spender</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_allowances</span><span class="p">[</span><span class="n">owner</span><span class="p">][</span><span class="n">spender</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_approve</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">sender</span><span class="p">,</span> <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_transfer</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
        <span class="n">_approve</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_allowances</span><span class="p">[</span><span class="n">sender</span><span class="p">][</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-</span> <span class="n">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify return values meet standard specifications</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Incorrect implementation
</span><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span>
    <span class="c1">// Missing return value!
</span><span class="p">}</span>

<span class="c1">// Correct implementation
</span><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span>
    <span class="k">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Emit all required events for token operations</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="n">_balances</span><span class="p">[</span><span class="n">recipient</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>

    <span class="c1">// Required ERC-20 event
</span>    <span class="k">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_allowances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span><span class="p">;</span>

    <span class="c1">// Required ERC-20 event
</span>    <span class="k">emit</span> <span class="n">Approval</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Ensure decimals() function returns the correct value for fungible tokens</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// For ERC-20 tokens
</span><span class="kt">uint8</span> <span class="k">private</span> <span class="k">constant</span> <span class="n">_decimals</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>

<span class="k">function</span> <span class="n">decimals</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_decimals</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Follow best practices for specific token standards:</p>

    <ul class="task-list">
      <li>
        <p>*ERC-20 Best Practices:**</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Protect against ERC-20 approve/transferFrom race conditions</p>
      </li>
    </ul>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Vulnerable to race condition
</span><span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="n">allowed</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Safer approach - force user to reset approval to zero first
</span><span class="k">function</span> <span class="n">safeApprove</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">currentValue</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">allowed</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">]</span> <span class="o">==</span> <span class="n">currentValue</span><span class="p">,</span> <span class="s">"Current allowance mismatch"</span><span class="p">);</span>
    <span class="n">allowed</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Alternative - increaseAllowance/decreaseAllowance pattern
</span><span class="k">function</span> <span class="n">increaseAllowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">addedValue</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_approve</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">_allowances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">]</span> <span class="o">+</span> <span class="n">addedValue</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">decreaseAllowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">subtractedValue</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">currentAllowance</span> <span class="o">=</span> <span class="n">_allowances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">spender</span><span class="p">];</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">currentAllowance</span> <span class="o">&gt;=</span> <span class="n">subtractedValue</span><span class="p">,</span> <span class="s">"ERC20: decreased allowance below zero"</span><span class="p">);</span>
    <span class="n">_approve</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">currentAllowance</span> <span class="o">-</span> <span class="n">subtractedValue</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Always emit Transfer event when minting/burning tokens</li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider implementing ERC-20 permit extension for gasless approvals</p>
      </li>
      <li class="task-list-item">
        <p>*ERC-721 Best Practices:**</p>
      </li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check for ownership before transfers</li>
    </ul>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">public</span> <span class="k">override</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">_isApprovedOrOwner</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">),</span> <span class="s">"ERC721: caller is not owner nor approved"</span><span class="p">);</span>
    <span class="n">_transfer</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">_isApprovedOrOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">_exists</span><span class="p">(</span><span class="n">tokenId</span><span class="p">),</span> <span class="s">"ERC721: token does not exist"</span><span class="p">);</span>
    <span class="kt">address</span> <span class="n">owner</span> <span class="o">=</span> <span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">spender</span> <span class="o">==</span> <span class="n">owner</span> <span class="o">||</span> <span class="n">getApproved</span><span class="p">(</span><span class="n">tokenId</span><span class="p">)</span> <span class="o">==</span> <span class="n">spender</span> <span class="o">||</span> <span class="n">isApprovedForAll</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">spender</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Correctly implement onERC721Received to prevent tokens from being locked in contracts</li>
    </ul>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">safeTransferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">transferFrom</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>

    <span class="c1">// If the recipient is a contract, verify it implements onERC721Received
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">to</span><span class="p">.</span><span class="n">isContract</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">try</span> <span class="n">IERC721Receiver</span><span class="p">(</span><span class="n">to</span><span class="p">).</span><span class="n">onERC721Received</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">,</span> <span class="n">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span> <span class="n">retval</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">require</span><span class="p">(</span><span class="n">retval</span> <span class="o">==</span> <span class="n">IERC721Receiver</span><span class="p">.</span><span class="n">onERC721Received</span><span class="p">.</span><span class="nb">selector</span><span class="p">,</span> <span class="s">"ERC721: transfer to non-ERC721Receiver implementation"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span> <span class="n">reason</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">reason</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">revert</span><span class="p">(</span><span class="s">"ERC721: transfer to non-ERC721Receiver implementation"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">assembly</span> <span class="p">{</span>
                    <span class="nb">revert</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">reason</span><span class="p">),</span> <span class="n">mload</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <ul class="task-list">
      <li>
        <p>*ERC-1155 Best Practices:**</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement batch functions efficiently</p>
      </li>
    </ul>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">safeBatchTransferFrom</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">from</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">to</span><span class="p">,</span>
    <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">ids</span><span class="p">,</span>
    <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">amounts</span><span class="p">,</span>
    <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">data</span>
<span class="p">)</span> <span class="k">public</span> <span class="k">override</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">from</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">||</span> <span class="n">isApprovedForAll</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">),</span> <span class="s">"ERC1155: caller is not owner nor approved"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">to</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"ERC1155: transfer to the zero address"</span><span class="p">);</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">ids</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">amounts</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="s">"ERC1155: ids and amounts length mismatch"</span><span class="p">);</span>

    <span class="c1">// Batch transfer operations
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ids</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="n">id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">uint256</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">amounts</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="kt">uint256</span> <span class="n">fromBalance</span> <span class="o">=</span> <span class="n">_balances</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">from</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">fromBalance</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"ERC1155: insufficient balance for transfer"</span><span class="p">);</span>
        <span class="n">_balances</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">from</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromBalance</span> <span class="o">-</span> <span class="n">amount</span><span class="p">;</span>
        <span class="n">_balances</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">emit</span> <span class="n">TransferBatch</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">amounts</span><span class="p">);</span>

    <span class="c1">// Call ERC1155Receiver implementation if recipient is a contract
</span>    <span class="n">_doSafeBatchTransferAcceptanceCheck</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">amounts</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Always check array length matches between ids and values</li>
    </ul>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider EIP-165 support for interface detection</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"@openzeppelin/contracts/utils/introspection/ERC165.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">MyNFT</span> <span class="k">is</span> <span class="n">ERC721</span><span class="p">,</span> <span class="n">ERC165</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">supportsInterface</span><span class="p">(</span><span class="kt">bytes4</span> <span class="n">interfaceId</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">override</span><span class="p">(</span><span class="n">ERC165</span><span class="p">,</span> <span class="n">ERC721</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
            <span class="n">interfaceId</span> <span class="o">==</span> <span class="k">type</span><span class="p">(</span><span class="n">IERC721</span><span class="p">).</span><span class="n">interfaceId</span> <span class="o">||</span>
            <span class="n">interfaceId</span> <span class="o">==</span> <span class="k">type</span><span class="p">(</span><span class="n">IERC721Metadata</span><span class="p">).</span><span class="n">interfaceId</span> <span class="o">||</span>
            <span class="nb">super</span><span class="p">.</span><span class="n">supportsInterface</span><span class="p">(</span><span class="n">interfaceId</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Validate all tokens against automated compliance tools</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Example check using slither token checker</span>
slither-check-erc my_token.sol MyToken
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Run test suites against standard reference implementations</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example using OpenZeppelin Test Helpers</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">expectRevert</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@openzeppelin/test-helpers</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">reverts when transferring tokens to the zero address</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">expectRevert</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">token</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">ZERO_ADDRESS</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="nx">holder</span> <span class="p">}),</span>
    <span class="dl">'</span><span class="s1">ERC20: transfer to the zero address</span><span class="dl">'</span>
  <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />If creating a wrapped token, ensure 1:1 backing and redemption</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of a wrapped token with 1:1 backing
</span><span class="k">contract</span> <span class="n">WrappedToken</span> <span class="k">is</span> <span class="n">ERC20</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="n">_mint</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"Insufficient balance"</span><span class="p">);</span>
        <span class="n">_burn</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
        <span class="k">payable</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Create detailed documentation of any extensions or deviations from standard</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title Enhanced ERC-20 Token
 * @dev This implementation adds the following features:
 * - Permit functionality (EIP-2612) for gasless transactions
 * - Token recovery for accidentally sent tokens
 * - Snapshot functionality for governance use cases
 * - Deviation from ERC-20: transfer and transferFrom revert instead of returning false
 * /
contract EnhancedToken is ERC20 {
    // Implementation...
}
</span></code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider implementing access control for token minting/burning</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ControlledToken</span> <span class="k">is</span> <span class="n">ERC20</span><span class="p">,</span> <span class="n">AccessControl</span> <span class="p">{</span>
    <span class="kt">bytes32</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">MINTER_ROLE</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">"MINTER_ROLE"</span><span class="p">);</span>
    <span class="kt">bytes32</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">BURNER_ROLE</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">"BURNER_ROLE"</span><span class="p">);</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="n">ERC20</span><span class="p">(</span><span class="s">"Controlled Token"</span><span class="p">,</span> <span class="s">"CTL"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">DEFAULT_ADMIN_ROLE</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">MINTER_ROLE</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">BURNER_ROLE</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">MINTER_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_mint</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">BURNER_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_burn</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Maintain backwards compatibility when upgrading token implementations</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// When upgrading existing tokens, ensure state variables maintain the same slots
// V1 Implementation
</span><span class="k">contract</span> <span class="n">TokenV1</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">private</span> <span class="n">_balances</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">))</span> <span class="k">private</span> <span class="n">_allowances</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">private</span> <span class="n">_totalSupply</span><span class="p">;</span>

    <span class="c1">// V1 functionality...
</span><span class="p">}</span>

<span class="c1">// V2 Implementation - Preserves original storage layout
</span><span class="k">contract</span> <span class="n">TokenV2</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">private</span> <span class="n">_balances</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">))</span> <span class="k">private</span> <span class="n">_allowances</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">private</span> <span class="n">_totalSupply</span><span class="p">;</span>

    <span class="c1">// New storage variables
</span>    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="k">private</span> <span class="n">_frozen</span><span class="p">;</span>

    <span class="c1">// V2 functionality...
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li class="task-list-item">
    <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />If creating a token bridge/wrapper, ensure strict security validation</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">TokenBridge</span> <span class="p">{</span>
    <span class="c1">// Verify signatures from the required number of validators
</span>    <span class="k">function</span> <span class="n">withdraw</span><span class="p">(</span>
        <span class="kt">bytes32</span> <span class="n">txHash</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="kt">bytes</span><span class="p">[]</span> <span class="k">calldata</span> <span class="n">signatures</span>
    <span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="c1">// Check that this message hasn't been processed before
</span>        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="n">processedMessages</span><span class="p">[</span><span class="n">messageId</span><span class="p">],</span> <span class="s">"Message already processed"</span><span class="p">);</span>

        <span class="c1">// Verify the message is valid
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">verifyMessageProof</span><span class="p">(</span><span class="n">messageId</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">proof</span><span class="p">),</span> <span class="s">"Invalid message proof"</span><span class="p">);</span>

        <span class="c1">// Mark message as processed before execution to prevent reentrancy
</span>        <span class="n">processedMessages</span><span class="p">[</span><span class="n">messageId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="c1">// Execute the message logic
</span>        <span class="n">_executeMessage</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="security-auditing">Security Auditing</h2>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Engage in formal verification for critical contracts</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Utilize automated tools for vulnerability scanning</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Conduct manual code reviews with a focus on security</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Keep up-to-date with the latest security advisories and patch accordingly</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider bug bounty programs to leverage community expertise</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Review and test all upgrade paths thoroughly before deployment</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Ensure proper testing of all security mechanisms in place</li>
</ul>


  </div>

</article>


    
    <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
      <!-- Removed github_edit_link tag -->
    </div>
    
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
  <script>anchors.add();</script>
</body>
</html>
