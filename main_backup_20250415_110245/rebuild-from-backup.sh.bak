#!/bin/bash
# Script to rebuild main deployment from backup-functional-demo branch

BACKUP_BRANCH="origin/backup-functional-demo"
CURRENT_BRANCH=$(git branch --show-current)

echo "===== Rebuilding Main from $BACKUP_BRANCH ====="
echo "Current branch: $CURRENT_BRANCH"

if [ "$CURRENT_BRANCH" != "main" ]; then
  echo "WARNING: You are not on the main branch. It's recommended to run this from main."
  echo "Would you like to continue anyway? (y/n)"
  read CONTINUE
  if [ "$CONTINUE" != "y" ] && [ "$CONTINUE" != "Y" ]; then
    echo "Exiting. Please checkout main branch first."
    exit 1
  fi
fi

# Create backup of current state
echo -e "\n===== Creating backup of current state ====="
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_DIR="main_backup_$TIMESTAMP"
mkdir -p "$BACKUP_DIR"
echo "Backing up current files to $BACKUP_DIR/"
rsync -av --exclude="$BACKUP_DIR" --exclude=".git" --exclude="node_modules" ./ "$BACKUP_DIR/"
echo "Backup created at $BACKUP_DIR/"
